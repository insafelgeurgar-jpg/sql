-- DIMENSION CLIENT
CREATE TABLE dim_client (
    id_client INT PRIMARY KEY,
    nom VARCHAR(100),
    pays VARCHAR(50)
);

-- DIMENSION PRODUIT
CREATE TABLE dim_produit (
    id_produit INT PRIMARY KEY,
    nom_produit VARCHAR(100),
    categorie VARCHAR(50)
);

-- DIMENSION TEMPS
CREATE TABLE dim_temps (
    id_temps INT PRIMARY KEY,
    date_commande DATE,
    mois INT,
    annee INT
);

-- TABLE FACT COMMANDE
CREATE TABLE fact_commandes (
    id_commande INT PRIMARY KEY,
    id_client INT,
    id_produit INT,
    id_temps INT,
    quantite INT,
    total DECIMAL(10,2),
    FOREIGN KEY (id_client) REFERENCES dim_client(id_client),
    FOREIGN KEY (id_produit) REFERENCES dim_produit(id_produit),
    FOREIGN KEY (id_temps) REFERENCES dim_temps(id_temps)
);
INSERT INTO dim_client VALUES
(1, 'Ahmed', 'Maroc'),
(2, 'Sara', 'France'),
(3, 'Youssef', 'Maroc');
INSERT INTO dim_produit VALUES
(1, 'PC Portable', 'Informatique'),
(2, 'Téléphone', 'Electronique'),
(3, 'Imprimante', 'Informatique');
INSERT INTO fact_commandes VALUES
(1, 1, 1, 1, 2, 12000),
(2, 2, 2, 2, 1, 5000),
(3, 1, 3, 2, 1, 3000),
(4, 3, 1, 3, 1, 6000),
(5, 2, 1, 1, 1, 6000);
/*  Quel est le chiffre d’affaires réalisé par chaque client ? */
SELECT 
    dim_client.nom AS nom_client,
    SUM(fact_commandes.total) AS chiffre_affaires
FROM fact_commandes
JOIN dim_client 
    ON fact_commandes.id_client = dim_client.id_client
GROUP BY dim_client.nom;


/* 2️ Quel est le montant total des ventes par catégorie de produit ? */
SELECT 
    dim_produit.categorie,
    SUM(fact_commandes.total) AS total_ventes
FROM fact_commandes
JOIN dim_produit 
    ON fact_commandes.id_produit = dim_produit.id_produit
GROUP BY dim_produit.categorie;


/* 3️ Combien de commandes ont été passées chaque année ? */
SELECT 
    dim_temps.annee,
    COUNT(fact_commandes.id_commande) AS nombre_commandes
FROM fact_commandes
JOIN dim_temps 
    ON fact_commandes.id_temps = dim_temps.id_temps
GROUP BY dim_temps.annee;


/*  Quels sont les 5 produits les plus vendus ? */
SELECT 
    dim_produit.nom_produit,
    SUM(fact_commandes.quantite) AS quantite_totale
FROM fact_commandes
JOIN dim_produit 
    ON fact_commandes.id_produit = dim_produit.id_produit
GROUP BY dim_produit.nom_produit
ORDER BY quantite_totale DESC
LIMIT 5;

